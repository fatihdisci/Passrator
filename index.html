<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Şifre Oluşturucu</title>
<meta name="theme-color" content="#0f0f11">
<style>
  :root{--bg:#0f0f11;--card:#16181d;--line:#262a33;--text:#e6e6e6;--muted:#9aa3ae;--accent:#4fb477;--danger:#d14d4d}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
  .card{width:100%;max-width:720px;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  h1{margin:0 0 12px;font-size:18px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .out{display:flex;gap:10px;align-items:center;background:#111319;border:1px solid var(--line);border-radius:12px;padding:10px}
  #pwd{flex:1;font:600 16px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;color:#fff;word-break:break-all}
  .btn{border:0;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;padding:10px 12px;cursor:pointer}
  .btn.ghost{background:#232833;color:var(--text);border:1px solid var(--line)}
  .btn.danger{background:var(--danger)}
  .grid{display:grid;gap:12px;margin-top:14px}
  .panel{border:1px solid var(--line);border-radius:12px;padding:12px;background:#12141a}
  .checks{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
  .check{display:flex;gap:8px;align-items:center;font-size:14px}
  .check input{width:18px;height:18px}
  .len{display:flex;gap:10px;align-items:center}
  input[type="number"]{width:90px;background:#0f1116;border:1px solid var(--line);border-radius:10px;color:#fff;padding:8px 10px}
  .hint{color:var(--muted);font-size:12px}
  .bar{height:8px;background:#1b1f29;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ff5a5f,#ffb15a,#4fb477)}
  .foot{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  /* Kayıtlı liste */
  .list{display:flex;flex-direction:column;gap:8px}
  .item{display:flex;gap:8px;align-items:center;justify-content:space-between;background:#0f1116;border:1px solid var(--line);border-radius:10px;padding:8px}
  .item .pw{font:600 14px/1.35 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;word-break:break-all;flex:1}
  .item .actions{display:flex;gap:6px}
  .sm{padding:6px 9px;font-weight:600;font-size:13px;border-radius:8px}
  .row-tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  @media (max-width:560px){.checks{grid-template-columns:1fr}.row{gap:8px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>🔐 Şifre Oluşturucu</h1>

    <div class="out">
      <div id="pwd" aria-live="polite">—</div>
      <button id="copyBtn" class="btn ghost" type="button">📋 Kopyala</button>
      <button id="genBtn" class="btn" type="button">🔑 Oluştur</button>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="len">
          <label for="len"><strong>Karakter sayısı</strong></label>
          <input id="len" type="number" min="4" max="64" value="12">
          <div class="hint">4 – 64</div>
        </div>
      </div>

      <div class="panel">
        <div class="checks">
          <label class="check"><input id="u" type="checkbox" checked> Büyük harf (A–Z)</label>
          <label class="check"><input id="l" type="checkbox" checked> Küçük harf (a–z)</label>
          <label class="check"><input id="d" type="checkbox" checked> Rakam (0–9)</label>
          <label class="check"><input id="s" type="checkbox"> Semboller (yalnızca . ve -)</label>
        </div>
        <div class="hint" style="margin-top:6px">Semboller yalnızca: <code>.</code> ve <code>-</code>. “Oluştur”a basınca otomatik kaydedilir.</div>
      </div>

      <div class="panel">
        <div class="foot">
          <div style="min-width:220px;flex:1">
            <div class="hint" id="msg">Hazır.</div>
            <div class="bar" aria-hidden="true"><span id="meter"></span></div>
          </div>
          <div class="row-tools">
            <button id="unlockBtn" class="btn ghost sm" type="button">👁️ Göster</button>
            <button id="lockBtn" class="btn ghost sm" type="button" style="display:none">🔒 Kilitle</button>
            <button id="clearBtn" class="btn danger sm" type="button">Tümünü Sil</button>
          </div>
        </div>
      </div>

      <div class="panel">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px">
          <strong>Kaydedilmiş Şifreler</strong>
          <span class="hint" id="countHint">0 kayıt</span>
        </div>
        <div id="lockedInfo" class="hint" style="display:block">
          🔒 Kayıtlar gizli. Görmek için <b>Göster</b> butonuna tıkla.
        </div>
        <div id="savedList" class="list" style="display:none"></div>
      </div>
    </div>

  </div>
</div>

<script>
(function(){
  // Elemanlar
  var elPwd=document.getElementById('pwd');
  var elLen=document.getElementById('len');
  var cbU=document.getElementById('u'), cbL=document.getElementById('l'),
      cbD=document.getElementById('d'), cbS=document.getElementById('s');
  var btnGen=document.getElementById('genBtn'), btnCopy=document.getElementById('copyBtn'), btnClear=document.getElementById('clearBtn');
  var elMsg=document.getElementById('msg'), elMeter=document.getElementById('meter');
  var listEl=document.getElementById('savedList'), countHint=document.getElementById('countHint');
  var btnUnlock=document.getElementById('unlockBtn'), btnLock=document.getElementById('lockBtn'), lockedInfo=document.getElementById('lockedInfo');

  // Karakter kümeleri
  var SET_U = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  var SET_L = "abcdefghijklmnopqrstuvwxyz";
  var SET_D = "0123456789";
  var SET_S = ".-"; // yalnızca . ve -

  // LocalStorage anahtarları
  var KEY='pwgen.saved.v1';
  var KEY_LOCK='pwgen.lock.hash.v1'; // SHA-256 hash
  var UNLOCKED=false;

  // Güvenli rasgele
  function rand(max){
    if(window.crypto && window.crypto.getRandomValues){
      var arr=new Uint32Array(1); window.crypto.getRandomValues(arr);
      return arr[0] % max;
    }
    return Math.floor(Math.random()*max);
  }
  function pick(set){ return set.charAt(rand(set.length)); }

  // Diziyi karıştır (Fisher–Yates)
  function shuffle(a){
    for(var i=a.length-1;i>0;i--){ var j=rand(i+1); var t=a[i]; a[i]=a[j]; a[j]=t; }
    return a;
  }

  // Güç göstergesi (DÜZELTİLMİŞ)
  function strength(p){
    var l=p.length, sets=0;
    if (/[A-Z]/.test(p)) sets++;
    if (/[a-z]/.test(p)) sets++;
    if (/[0-9]/.test(p)) sets++;
    if (/[.\-]/.test(p)) sets++;
    var score = Math.min(100, Math.round((l/64)*60 + sets*10 + (l>=12?10:0)));
    elMeter.style.width = score + "%";
    elMsg.textContent = score<40 ? "Zayıf" : score<70 ? "Orta" : "Güçlü";
  }

  // SHA-256 (hex)
  function sha256Hex(str){
    if(!window.crypto || !window.crypto.subtle || !window.TextEncoder){
      alert("Tarayıcı bu kilit özelliğini desteklemiyor."); return Promise.reject();
    }
    var enc = new TextEncoder().encode(str);
    return crypto.subtle.digest('SHA-256', enc).then(function(buf){
      var arr = Array.from(new Uint8Array(buf));
      return arr.map(function(b){return b.toString(16).padStart(2,'0')}).join('');
    });
  }

  // ----- ŞİFRE ÜRETME -----
  function generate(saveIt){
    var len = parseInt(elLen.value,10);
    if(isNaN(len) || len<4 || len>64){ elMsg.textContent="Uzunluk 4–64 olmalı"; return; }

    var pools=[], must=[];
    if(cbU.checked){ pools.push(SET_U); must.push(pick(SET_U)); }
    if(cbL.checked){ pools.push(SET_L); must.push(pick(SET_L)); }
    if(cbD.checked){ pools.push(SET_D); must.push(pick(SET_D)); }
    if(cbS.checked){ pools.push(SET_S); must.push(pick(SET_S)); }

    if(pools.length===0){ elMsg.textContent="En az bir kural seçin"; return; }

    var pool = pools.join('');
    var out = must.slice();
    while(out.length < len){ out.push( pick(pool) ); }

    shuffle(out);
    var pwd = out.join('');
    elPwd.textContent = pwd;
    strength(pwd);

    if(saveIt){ savePassword(pwd); }
  }

  function copyCurrent(){
    var txt = elPwd.textContent || "";
    if(!txt || txt === "—"){ elMsg.textContent="Önce bir şifre üret"; return; }
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(txt).then(function(){ elMsg.textContent="Kopyalandı"; });
    }else{
      var ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta);
      ta.select(); try{ document.execCommand('copy'); elMsg.textContent="Kopyalandı"; }catch(e){ elMsg.textContent="Kopyalanamadı"; }
      ta.remove();
    }
  }

  // ----- KAYIT & LİSTE -----
  function loadAll(){ try{ var raw=localStorage.getItem(KEY); return raw? JSON.parse(raw): []; }catch(e){ return []; } }
  function saveAll(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

  function savePassword(p){
    var arr = loadAll();
    arr.unshift({ pw:p, t:Date.now() });
    if(arr.length>200) arr = arr.slice(0,200);
    saveAll(arr);
    if(UNLOCKED) renderList();
  }

  function deletePassword(idx){
    if(!UNLOCKED){ elMsg.textContent="Önce kilidi aç"; return; }
    var arr = loadAll();
    if(idx>=0 && idx<arr.length){ arr.splice(idx,1); saveAll(arr); renderList(); }
  }

  function clearAllSaved(){
    if(!UNLOCKED){ elMsg.textContent="Önce kilidi aç"; return; }
    if(!confirm("Tüm kayıtlı şifreler silinsin mi?")) return;
    saveAll([]); renderList();
  }

  function renderList(){
    var arr = loadAll();
    countHint.textContent = arr.length + " kayıt";

    if(!UNLOCKED){
      listEl.style.display = "none";
      lockedInfo.style.display = "block";
      btnUnlock.style.display = "inline-flex";
      btnLock.style.display = "none";
      return;
    }

    lockedInfo.style.display = "none";
    listEl.style.display = "flex";
    btnUnlock.style.display = "none";
    btnLock.style.display = "inline-flex";

    listEl.innerHTML = "";
    if(arr.length===0){
      var empty = document.createElement('div');
      empty.className = "hint";
      empty.textContent = "Kayıt yok. 'Oluştur' ile şifre ürettiğinde otomatik kaydedilir.";
      listEl.appendChild(empty);
      return;
    }
    for(var i=0;i<arr.length;i++){
      (function(item, idx){
        var row = document.createElement('div'); row.className="item";
        var pw = document.createElement('div'); pw.className="pw"; pw.textContent = item.pw;
        var actions = document.createElement('div'); actions.className="actions";
        var bCopy = document.createElement('button'); bCopy.className="btn ghost sm"; bCopy.textContent="Kopyala";
        bCopy.addEventListener('click', function(){
          if(navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(item.pw).then(function(){ elMsg.textContent="Kopyalandı"; });
          }else{
            var ta=document.createElement('textarea'); ta.value=item.pw; document.body.appendChild(ta);
            ta.select(); try{ document.execCommand('copy'); elMsg.textContent="Kopyalandı"; }catch(e){ elMsg.textContent="Kopyalanamadı"; }
            ta.remove();
          }
        });
        var bDel = document.createElement('button'); bDel.className="btn danger sm"; bDel.textContent="Sil";
        bDel.addEventListener('click', function(){ deletePassword(idx); });
        actions.appendChild(bCopy); actions.appendChild(bDel);
        row.appendChild(pw); row.appendChild(actions);
        listEl.appendChild(row);
      })(arr[i], i);
    }
  }

  // ----- KİLİT AKIŞI -----
  function hasLock(){ return !!localStorage.getItem(KEY_LOCK); }

  function setLockFlow(){
    var p1 = prompt("Görüntüleme şifresi belirle (min 4 karakter):"); if(p1===null) return;
    p1 = (p1||"").trim();
    if(p1.length<4){ alert("En az 4 karakter olmalı."); return; }
    var p2 = prompt("Şifreyi tekrar yaz:"); if(p2===null) return;
    if(p1!==p2){ alert("Eşleşmiyor."); return; }
    sha256Hex(p1).then(function(h){
      localStorage.setItem(KEY_LOCK, h);
      UNLOCKED=true; renderList();
      elMsg.textContent="Kilit oluşturuldu ve açıldı.";
    });
  }

  function unlockFlow(){
    if(!hasLock()){ setLockFlow(); return; }
    var p = prompt("Görüntüleme şifresi:");
    if(p===null) return;
    sha256Hex(p).then(function(h){
      var stored = localStorage.getItem(KEY_LOCK);
      if(h===stored){
        UNLOCKED=true; renderList(); elMsg.textContent="Kilit açıldı.";
      }else{
        elMsg.textContent="Yanlış şifre.";
      }
    });
  }

  function lockNow(){
    UNLOCKED=false; renderList(); elMsg.textContent="Kilitlendi.";
  }

  // Bağlamalar
  btnGen.addEventListener('click', function(){ generate(true); });
  btnCopy.addEventListener('click', copyCurrent);
  btnClear.addEventListener('click', clearAllSaved);
  elLen.addEventListener('input', function(){ var v=parseInt(elLen.value,10); if(v<4) elLen.value=4; if(v>64) elLen.value=64; });

  btnUnlock.addEventListener('click', unlockFlow);
  btnLock.addEventListener('click', lockNow);

  // İlk açılış: örnek üret (kaydetme), listeyi kilit durumuna göre göster
  generate(false);
  renderList();
})();
</script>
</body>
</html>
